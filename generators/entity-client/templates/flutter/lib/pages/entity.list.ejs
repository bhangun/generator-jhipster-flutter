<%_
  const dartFields = {};
  const index = {};
  let hasUserRelationship = false;
  const id = {};
  var i=0;

  id['type'] = 'int';
  id['name'] = 'id';
  id['i']=i;
  dartFields['id'] = id;

  fields.forEach(field => {
      i++;
      const varValue = {};
      const fieldType = field.fieldType;
      const fieldName = field.fieldName;
      let dartType;
      let dartCont;
      let desc;
      if (field.fieldIsEnum) {
          dartType = fieldType;
      } else if ( fieldType === 'UUID' || fieldType === 'String') {
          dartType = 'String';
          dartCont = 'TextEditingController()';
      } else if ( fieldType === 'Instant') {
          dartType = 'DartTime';
          desc = '.toIso8601String()' + 'Z';
      } else {
          dartType = fieldType ;
      } 

      varValue['type'] = dartType;
      varValue['name'] = fieldName;
      varValue['desc'] = desc;
      varValue['cont'] = dartCont;
      varValue['i']=i;
      
      dartFields[fieldName] = varValue;
  });

  relationships.forEach(relationship => {
    let fieldType;
    let fieldName;
    const relationshipType = relationship.relationshipType;
    if (relationshipType === 'one-to-many' || relationshipType === 'many-to-many') {
        if (relationship.otherEntityAngularName === 'User') {
            fieldType = 'User[]';
            hasUserRelationship = true;
        } else {
            fieldType = 'BaseEntity[]';
        }
        fieldName = relationship.relationshipFieldNamePlural;
    } else {
        if (dto === 'no') {
            if (relationship.otherEntityAngularName === 'User') {
                fieldType = 'User';
                hasUserRelationship = true;
            } else {
                fieldType = 'BaseEntity';
            }
            fieldName = relationship.relationshipFieldName;
        } else {
            fieldType = dartKeyType;
            fieldName = `${relationship.relationshipFieldName}Id`;
        }
    }
    
  });
_%>
import 'package:flutter/material.dart';
import '<%= entityAngularName.toLowerCase() %>.detail.dart';
import '<%= entityAngularName.toLowerCase() %>.helper.dart';
import '<%= entityAngularName.toLowerCase() %>.dart';
import 'dart:convert';
import '<%= entityAngularName.toLowerCase() %>.form.dart';

class <%= entityAngularName %>ListPage extends StatefulWidget {

  @override
  _<%= entityAngularName %>ListPageState createState() => _<%= entityAngularName %>ListPageState();
}

final String _title = "<%= entityAngularName %> List";

class _<%= entityAngularName %>ListPageState extends State<<%= entityAngularName %>ListPage> {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
        appBar: AppBar(
          title: Text(_title),
          elevation: 5.0, // Removing the drop shadow cast by the app bar.
        ),
        body: FutureBuilder(
            future: <%= entityAngularName.toLowerCase() %>s(),
            builder: (BuildContext context, AsyncSnapshot snapshot) {
              return snapshot.hasData
                  ? <%= entityAngularName %>List(data: snapshot.data)
                  : Center(child: CircularProgressIndicator());
            }),
        floatingActionButton: FloatingActionButton(
          onPressed: () {
            Navigator.push(context,
                MaterialPageRoute(builder: (context) => <%= entityAngularName %>FormPage()));
          },
          tooltip: 'Add',
          child: Icon(Icons.add),
        ));
  }
}
<% for(var i=0;i<fields.length;i++){%> <%} %>

Widget item(<%for (idx in dartFields) { %><%= dartFields[idx]['type'] %> <%= dartFields[idx]['name'] %>, <%}%>
BuildContext context) {
  return ListTile(
      title: Text(<%if(fields.length>0) {%> <%= fields[0].fieldName %><%} %>,
      style: TextStyle(fontWeight: FontWeight.w500, fontSize: 20.0)),<%if(fields.length>1) {%>
      subtitle: Text(<%= fields[1].fieldName %>),<%} %>
      onTap: () {
        Navigator.push(
            context,
            MaterialPageRoute(
                builder: (context) => <%= entityAngularName %>Detail(id: id )));
      },
      leading: Icon(Icons.person, size: 50,color: Colors.blue[500]));
}

class <%= entityAngularName %>List extends StatelessWidget {
  final String data;
  <%= entityAngularName %>List({this.data});

  @override
  Widget build(BuildContext context) {
    final parsed = json.decode(data).cast<Map<String, dynamic>>();
    List<<%= entityAngularName %>> _items =
        parsed.map<<%= entityAngularName %>>((json) => <%= entityAngularName %>.fromJson(json)).toList();
    return ListView.builder(
      itemCount: _items.length,
      itemBuilder: (context, index) {
        final <%= entityAngularName.toLowerCase() %> = _items[index];
        return item(<%for (idx in dartFields) { %> 
        <%= entityAngularName.toLowerCase() %>.<%= dartFields[idx]['name'] %>, <%}%>
           context);
      },
    );
  }
}
